<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
    <h:head>
        <title>Take New Order</title>
        <style>
            .sidebar {
                width: 280px;
                background-color: #ffffff;
                height: 100vh;
                padding: 30px 10px;
                box-shadow: 8px 0 10px rgba(0,0,0,0.05);
                float: left;
                font-family: 'Segoe UI', sans-serif;
            }

            .sidebar h2 {
                display: flex;
                align-items: center;
                font-size: 28px;
                font-weight: bold;
                color: #1f2937;
                margin-bottom: 40px;
            }

            .menu-button {

                display: flex;
                align-items: center;
                padding: 3px 7px;
                font-size: 1.3rem !important;
                font-weight: bold;
                color: #000000;
                transition: background-color 0.3s ease;
                width: 98%;
                text-align: left;
            }

            body .ui-button {
                background: #FFFFFF;
                color: black;
                margin-bottom: 1rem;
                outline: 0 none;
                border:none;
                border-radius: 8px !important;
                transition: box-shadow .4s, opacity .2s;
            }
            /*            .menu-button i {
                            margin-right: 10px;
                            font-size: 1.2em;
                        }*/

            .menu-button:hover {
                background-color: whitesmoke !important;
                color: black !important;
                border-radius:6px !important;
            }

            .menu-button.active {
                background-color: coral !important; /* green */
                color: white !important;
            }

            /*            .menu-button.active i {
                            color: white !important;
                        }*/
            .main-content {
                margin-left: 280px;
                padding: 20px;
                font-family: 'Segoe UI', sans-serif;

            }
            .menu-item-card {
                max-width: 28%;

                border: 2px solid black;
                border-radius: 10px;
                padding: 16px;
                margin: 8px;
                width: 240px;
                flex: 1 1 1 30%;  /* Reduced from ~33% to 30% */
                box-sizing: border-box;

            }
            .price {
                color: green;
                font-weight: bold;
            }

            body .ui-panel .ui-panel-titlebar {
                border: 2px solid #dee2e6;
                background: #f8f9fa;
                color: black;
                padding: 0.5rem;
                font-weight: bold;
                border-bottom-right-radius: 0;
                border-bottom-left-radius: 0;
                border-top-left-radius: 4px;
                border-top-right-radius: 4px;
            }

            body .ui-tabs .ui-tabs-nav li.ui-tabs-header a {
                color: black;
                padding: 0;
                font-weight: 700;
                display: block;
                line-height: 1;
                transition: background-color .2s, color .2s, border-color .2s, box-shadow .2s, opacity .2s;
            }
            .add-order-btn {
                background-color: #0d1224 !important;   /* Dark navy */
                color: white !important;
                border: none !important;
                font-weight: 600;
                border-radius: 10px;
                padding: 0.3rem 1.2rem;
                width: 100%;
                justify-content: center;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                box-shadow: none;
            }

            .add-order-btn:hover {
                background-color: #1a203a !important;
            }
            .menu-container {
                display: flex;
                flex-wrap: wrap;
                gap: 20px; /* space between cards */
            }


            /*-*/

            .order-item-box {
                border: 1px solid #e0e0e0;
                border-radius: 12px;
                padding: 12px;
                margin-bottom: 10px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-family: 'Segoe UI', sans-serif;
                background-color: #ffffff;
            }

            .item-details {
                display: flex;
                flex-direction: column;
            }

            .item-name {
                font-weight: 600;
                color: #111827;
                font-size: 1rem;
            }

            .item-price {
                color: #6b7280;
                font-size: 0.9rem;
            }

            .quantity-controls {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .qty-btn, .delete-btn {
                border-radius: 8px !important;
                background-color: #f9fafb !important;
                border: 1px solid #e5e7eb !important;
                color: #111827 !important;
                padding: 6px 8px;
                font-size: 0.9rem;
            }

            .qty-btn:hover, .delete-btn:hover {
                background-color: #e5e7eb !important;
            }

            .quantity {
                font-weight: bold;
                width: 20px;
                text-align: center;
            }




        </style>
    </h:head>

    <h:body>
        <h:form id="orderForm">

            <!-- Sidebar -->
            <div class="sidebar">
                <h2><i class="pi pi-users" style="font-size: 1.5em; color: #22c55e; margin-right: 10px;" /> Staff Panel</h2>

                <p:commandButton value="Back to Home" icon="pi pi-home"
                                 action="#{navigationBean.goHome()}"
                                 styleClass="menu-button #{navigationBean.activePage eq 'home' ? 'active' : ''}"
                                 update="orderForm" />

                <p:commandButton value="Dashboard" icon="pi pi-th-large"
                                 action="#{navigationBean.goDashboard}"
                                 styleClass="menu-button #{navigationBean.activePage eq 'dashboard' ? 'active' : ''}"
                                 update="orderForm" />

                <p:commandButton value="Take Order" icon="pi pi-plus"
                                 action="#{navigationBean.goOrder}"
                                 styleClass="menu-button #{navigationBean.activePage eq 'order' ? 'active' : ''}" 
                                 update="orderForm"/>

                <p:commandButton value="Table Status" icon="pi pi-users"
                                 action="#{navigationBean.goTableStatus}"
                                 styleClass="menu-button #{navigationBean.activePage eq 'table' ? 'active' : ''}" 
                                 update="orderForm" />

                <p:commandButton value="Order History" icon="pi pi-calendar"
                                 action="#{navigationBean.goOrderHistory}"
                                 styleClass="menu-button #{navigationBean.activePage eq 'history' ? 'active' : ''}"
                                 update="orderForm" />
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <h1>Take New Order</h1>

                <div style="display: flex; justify-content: space-between;">
                    <!-- Menu Items Section -->
                    <p:panel header="Menu Items" style="width: 70%;">
                        <p:tabView>
                            <c:forEach items="#{orderBean.categoryList}" var="category">
                                <p:tab title="#{category.categoryName}">
                                    <div class="menu-container">
                                        <ui:repeat value="#{orderBean.getItemsByCategory(category)}" var="item">
                                            <div class="menu-item-card">
                                                <h2>#{item.itemName}</h2>
                                                <p>#{item.description}</p>
                                                <p class="price">$#{item.itemPrice}</p>
                                                <p:commandButton value="Add to Order"
                                                                 icon="pi pi-plus"
                                                                 styleClass="add-order-btn"
                                                                 action="#{orderBean.addToOrder(item)}"
                                                                 update=":orderForm:orderPanel"/>
                                            </div>
                                        </ui:repeat>
                                    </div>
                                </p:tab>
                            </c:forEach>
                        </p:tabView>
                    </p:panel>
                    <!-- Current Order Section -->
                    <p:panel id="orderPanel" header="Current Order" style="width: 28%; min-height: 300px;">
                        <h:outputText value="Select Table" style=" font-weight: bold"/>
                        <p:selectOneMenu value="#{orderBean.selectedTable}" style="width:100%; margin-bottom:2rem">
                            <f:selectItem itemLabel="Choose a table" itemValue="" />
                            <f:selectItems value="#{orderBean.tables}" var="t"
                                           itemLabel="#{t.tableNumber}" itemValue="#{t.tableId}" />
                        </p:selectOneMenu>
                        <h:outputText value="Select No-of-peoples" style=" font-weight: bold"/>
                        <p:inputText value="#{orderBean.noofpeoples}"
                                     style="width: 100%; margin-bottom: 1rem;" />



                        <p:spacer height="10" />
                        <h:outputText value="Order Items:" style="font-weight: bold; margin-bottom: 2rem;" />

                        <ui:repeat value="#{orderBean.orderItems}" var="oi">
                            <div class="order-item-box">
                                <div class="item-details">
                                    <div class="item-name">#{oi.itemName}</div>
                                    <div class="item-price">$#{oi.itemPrice} each</div>
                                </div>

                                <div class="quantity-controls">
                                    <p:commandButton icon="pi pi-minus"
                                                     action="#{orderBean.decrementQuantity(oi)}"
                                                     process="@form"
                                                     update=":orderForm:orderPanel"
                                                     styleClass="qty-btn" />

                                    <span class="quantity">#{orderBean.map[oi.menuId]}</span>

                                    <p:commandButton icon="pi pi-plus"
                                                     action="#{orderBean.incrementQuantity(oi.menuId)}"
                                                     process="@form"
                                                     update=":orderForm:orderPanel"
                                                     styleClass="qty-btn" />

                                    <p:commandButton icon="pi pi-trash"
                                                     process="@form"
                                                     action="#{orderBean.removequantity(oi)}"
                                                     update=":orderForm:orderPanel"
                                                     styleClass="delete-btn" />
                                </div>
                            </div>
                        </ui:repeat>

                        <h:outputText rendered="#{empty orderBean.orderItems}" value="No items added yet." />

                        <hr />
                        <div style="display: flex; justify-content: space-between; font-weight: bold;">
                            <span>Total:</span>
                            <h:outputText value="$#{orderBean.price}" />
                        </div>

                        <p:commandButton value="Submit Order"
                                         styleClass="add-order-btn"
                                         action="#{orderBean.submitorder}"
                                         update="@form" />
                    </p:panel>
                </div>
            </div>

        </h:form>
    </h:body>
</html>
