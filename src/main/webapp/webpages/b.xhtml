<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
    <h:head>
        <title>Take New Order</title>
        <style>
            .sidebar {
                    position: fixed;               /* Make sidebar sticky */

                width: 280px;
                background-color: #ffffff;
                height: 100vh;
                padding: 30px 10px;
                box-shadow: 8px 0 10px rgba(0,0,0,0.05);
                float: left;
                font-family: 'Segoe UI', sans-serif;
            }

            .sidebar h2 {
                display: flex;
                align-items: center;
                font-size: 28px;
                font-weight: bold;
                color: #1f2937;
                margin-bottom: 40px;
            }

            .menu-button {

                display: flex;
                align-items: center;
                padding: 3px 7px;
                font-size: 1.3rem !important;
                font-weight: bold;
                color: #000000;
                transition: background-color 0.3s ease;
                width: 98%;
                text-align: left;
            }

            body .ui-button {
                background: #FFFFFF;
                color: black;
                margin-bottom: 1rem;
                outline: 0 none;
                border:none;
                border-radius: 8px !important;
                transition: box-shadow .4s, opacity .2s;
            }
            /*            .menu-button i {
                            margin-right: 10px;
                            font-size: 1.2em;
                        }*/

            .menu-button:hover {
                background-color: whitesmoke !important;
                color: black !important;
                border-radius:6px !important;
            }

            .menu-button.active {
                background-color: coral !important; /* green */
                color: white !important;
            }

            /*            .menu-button.active i {
                            color: white !important;
                        }*/
            .main-content {
                margin-left: 280px;
                padding: 20px;
                font-family: 'Segoe UI', sans-serif;

            }
            .menu-item-card {
                max-width: 28%;

                border: 2px solid black;
                border-radius: 10px;
                padding: 16px;
                margin: 8px;
                width: 240px;
                flex: 1 1 1 30%;  /* Reduced from ~33% to 30% */
                box-sizing: border-box;

            }
            .price {
                color: green;
                font-weight: bold;
            }

            body .ui-panel .ui-panel-titlebar {
                border: 2px solid #dee2e6;
                background: #f8f9fa;
                color: black;
                padding: 0.5rem;
                font-weight: bold;
                border-bottom-right-radius: 0;
                border-bottom-left-radius: 0;
                border-top-left-radius: 4px;
                border-top-right-radius: 4px;
            }

            body .ui-tabs .ui-tabs-nav li.ui-tabs-header a {
                color: black;
                padding: 0;
                font-weight: 700;
                display: block;
                line-height: 1;
                transition: background-color .2s, color .2s, border-color .2s, box-shadow .2s, opacity .2s;
            }
            .add-order-btn {
                background-color: #0d1224 !important;   /* Dark navy */
                color: white !important;
                border: none !important;
                font-weight: 600;
                border-radius: 10px;
                padding: 0.3rem 1.2rem;
                width: 100%;
                justify-content: center;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                box-shadow: none;
            }

            .add-order-btn:hover {
                background-color: #1a203a !important;
            }
            .menu-container {
                display: flex;
                flex-wrap: wrap;
                gap: 20px; /* space between cards */
            }


            /*-*/

            .order-item-box {
                border: 1px solid #e0e0e0;
                border-radius: 12px;
                padding: 12px;
                margin-bottom: 10px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-family: 'Segoe UI', sans-serif;
                background-color: #ffffff;
            }

            .item-details {
                display: flex;
                flex-direction: column;
            }

            .item-name {
                font-weight: 600;
                color: #111827;
                font-size: 1rem;
            }

            .item-price {
                color: #6b7280;
                font-size: 0.9rem;
            }

            .quantity-controls {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .qty-btn, .delete-btn {
                border-radius: 8px !important;
                background-color: #f9fafb !important;
                border: 1px solid #e5e7eb !important;
                color: #111827 !important;
                padding: 6px 8px;
                font-size: 0.9rem;
            }

            .qty-btn:hover, .delete-btn:hover {
                background-color: #e5e7eb !important;
            }

            .quantity {
                font-weight: bold;
                width: 20px;
                text-align: center;
            }

            /*-order*/



            .order-card {
                border: 1px solid #ccc;
                border-radius: 8px;
                padding: 1rem;
                margin: 1rem 0;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                background-color: #fff;
                position: relative;
                justify-content:space-between;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                transition: box-shadow 0.3s ease-in-out;
            }

            .order-card:hover {
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            }

            .order-header {
                display: flex;
                justify-content: space-between;
                font-weight: bold;
                margin-bottom: 0.0 rem;
                margin-right:1.5rem;
            }

            .order-id {
                font-size: 1.2rem;
            }

            .order-status {
                padding: 0.2rem 0.6rem;
                border-radius: 0.5rem;
                font-size: 0.9rem;
                text-transform: capitalize;
            }

            .completed {
                background-color: #e0f2f1;
                color: #00695c;
            }

            .in-progress {
                background-color: #e3f2fd;
                color: #1565c0;
            }

            .order-info {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin: 0.1rem 0;
                font-size: 0.95rem;
                justify-content: space-between;
            }

            .order-footer {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 1rem;
            }

            .order-total {
                font-size: 1.2rem;
                font-weight: bold;
            }

            .details-btn {
                background-color: #111827;
                color: #fff;
                border-radius: 6px;
            }

            body .ui-panel .ui-panel-titlebar {
                border: 2px solid #dee2e6;
                background: #f8f9fa;
                color: black;
                padding: 0.5rem 8px;
                font-weight: bold;
                border-bottom-right-radius: 0;
                border-bottom-left-radius: 0;
                border-top-left-radius: 4px;
                border-top-right-radius: 4px;
                height: 3rem;
            }

            /*view details */

            .back-btn {
                margin-bottom: 1rem;
            }

            .section-title {
                font-size: 1.5rem;
                font-weight: bold;
                margin-bottom: 1.5rem;

            }

            .order-container {
                display: flex;
                gap: 2rem;
            }

            .order-cardd {
                width: 50%;
                background-color: #fff;
                padding: 2rem;
                border-radius: 12px;
                box-shadow: 0 2px 6px rgba(0,0,0,0.1);
                margin-bottom: 2rem;
            }

            .order-label {
                font-weight: bold;
                margin-top: 1rem;
            }


            .grid-layout {
                display: grid;
                grid-template-columns: 1fr 1fr; /* 2 columns */
                gap: 1.5rem 2rem; /* row-gap, column-gap */
            }

            .order-value {
                margin-bottom: 1rem;

                color: #333;
            }

            .field-box {
                display: flex;
                flex-direction: column;
            }

            .status-pill {
                background-color: #0d1224;
                color: white;
                padding: 0.3rem 1rem;
                border-radius: 999px;
                font-weight: bold;
                display: inline-block;
                width: fit-content;

            }

            .item-box {
                background-color: #f5f7fa;
                padding: 1rem;
                margin-bottom: 1rem;
                border-radius: 8px;
                display: flex;
                justify-content: space-between;
            }

            .total {
                font-weight: bold;
                text-align: right;
                font-size: 1.2rem;
            }

            .payment-section {
                margin-top: 2rem;
                display: flex;
                align-items: center;
                gap: 2rem;
                flex-wrap: wrap;
            }

            .payment-dropdown {
                min-width: 200px;
            }

            .generate-bill-btn {
                background-color: #0d1224;
                color: white;
                font-weight: bold;
                border-radius: 8px;
                padding: 0.5rem 1.5rem;
            }


        </style>
    </h:head>

    <h:body>
        <h:form id="orderForm">

            <!-- Sidebar -->
            <div class="sidebar">
                <h2><i class="pi pi-users" style="font-size: 1.5em; color: #22c55e; margin-right: 10px;" /> Staff Panel</h2>

                <p:commandButton value="Back to Home" icon="pi pi-home"
                                 action="#{navigationBean.goHome()}"
                                 styleClass="menu-button #{navigationBean.activePage eq 'home' ? 'active' : ''}"
                                 update="@form" />

                <p:commandButton value="Dashboard" icon="pi pi-th-large"
                                 action="#{navigationBean.goDashboard}"
                                 styleClass="menu-button #{navigationBean.activePage eq 'dashboard' ? 'active' : ''}"
                                 update="@form" />

                <p:commandButton value="Take Order" icon="pi pi-plus"
                                 action="#{navigationBean.goOrder}"
                                 styleClass="menu-button #{navigationBean.activePage eq 'order' ? 'active' : ''}" 
                                 update="@form"/>

                <p:commandButton value="Order History" icon="pi pi-calendar"
                                 action="#{navigationBean.goOrderHistory}"
                                 styleClass="menu-button #{navigationBean.activePage eq 'history' ? 'active' : ''}"
                                 update="@form" />
                <div class="logout-btn" style="margin-top: 14rem; margin-left: 2.5rem">
                    <p:commandButton value="Logout" icon="pi pi-sign-out"
                                     action="#{loginBean.logout()}"
                                     styleClass="ui-button-danger" />
            </div>
            </div>

            <!-- Main Content -->
            <h:panelGroup rendered="#{navigationBean.activePage eq 'order'}" layout="block" styleClass="main-content">
                <h1>Take New Order</h1>
                <div style="display: flex; justify-content: space-between;">
                    <!-- Menu Items Section -->
                    <p:panel header="Menu Items" style="width: 70%;">
                        <p:tabView>
                            <c:forEach items="#{orderBean.categoryList}" var="category">
                                <p:tab title="#{category.categoryName}">
                                    <div class="menu-container">
                                        <ui:repeat value="#{orderBean.getItemsByCategory(category)}" var="item">
                                            <div class="menu-item-card">
                                                <h2>#{item.itemName}</h2>
                                                <p>#{item.description}</p>
                                                <p class="price">$#{item.itemPrice}</p>
                                                <p:commandButton value="Add to Order"
                                                                 icon="pi pi-plus"
                                                                 styleClass="add-order-btn"
                                                                 action="#{orderBean.addToOrder(item)}"
                                                                 update=":orderForm:orderPanel"/>
                                            </div>
                                        </ui:repeat>
                                    </div>
                                </p:tab>
                            </c:forEach>
                        </p:tabView>
                    </p:panel>
                    <!-- Current Order Section -->
                    <p:panel id="orderPanel" header="Current Order" style="width: 28%; min-height: 300px;">
                        <h:outputText value="Select Table" style=" font-weight: bold"/>
                        <p:selectOneMenu value="#{orderBean.selectedTable}" style="width:100%; margin-bottom:2rem">
                            <f:selectItem itemLabel="Choose a table" itemValue="" />
                            <f:selectItems value="#{orderBean.tables}" var="t"
                                           itemLabel="#{t.tableNumber}" itemValue="#{t.tableId}" />
                        </p:selectOneMenu>
                        <h:outputText value="Select No-of-peoples" style=" font-weight: bold"/>
                        <p:inputText value="#{orderBean.noofpeoples}"
                                     style="width: 100%; margin-bottom: 1rem;" />



                        <p:spacer height="10" />
                        <h:outputText value="Order Items:" style="font-weight: bold; margin-bottom: 2rem;" />

                        <ui:repeat value="#{orderBean.orderItems}" var="oi">
                            <div class="order-item-box">
                                <div class="item-details">
                                    <div class="item-name">#{oi.itemName}</div>
                                    <div class="item-price">$#{oi.itemPrice} each</div>
                                </div>

                                <div class="quantity-controls">
                                    <p:commandButton icon="pi pi-minus"
                                                     action="#{orderBean.decrementQuantity(oi)}"
                                                     process="@form"
                                                     update=":orderForm:orderPanel"
                                                     styleClass="qty-btn" />

                                    <span class="quantity">#{orderBean.map[oi.menuId]}</span>

                                    <p:commandButton icon="pi pi-plus"
                                                     action="#{orderBean.incrementQuantity(oi.menuId)}"
                                                     process="@form"
                                                     update=":orderForm:orderPanel"
                                                     styleClass="qty-btn" />

                                    <p:commandButton icon="pi pi-trash"
                                                     process="@form"
                                                     action="#{orderBean.removequantity(oi)}"
                                                     update=":orderForm:orderPanel"
                                                     styleClass="delete-btn" />
                                </div>
                            </div>
                        </ui:repeat>

                        <h:outputText rendered="#{empty orderBean.orderItems}" value="No items added yet." />

                        <hr/>
                        <div style="display: flex; justify-content: space-between; font-weight: bold;">
                            <span>Total:</span>
                            <h:outputText value="$#{orderBean.price}" />
                        </div>

                        <p:commandButton value="Submit Order"
                                         styleClass="add-order-btn"
                                         action="#{orderBean.submitorder}"
                                         update="@form" />
                    </p:panel>
                </div>
            </h:panelGroup>


            <h:panelGroup rendered="#{navigationBean.activePage eq 'history'}" layout="block" styleClass="main-content">

                <p:panel header="📝 Your Order History" style="width: 90%; font-weight:bold;  margin: 0 auto; font-size: 1.3rem">

                    <ui:repeat value="#{orderhistorybean.order}" var="order">
                        <div class="order-card"     >
                            <div class="order-header">
                                <div>
                                    ORD - <h:outputText value="#{order.orderId}" styleClass="order-id" style="margin-right: 1rem" />
                                    <h:outputText value="#{order.iscompleted ? 'completed' : 'in-progress'}"
                                                  styleClass="order-status #{order.iscompleted ? 'completed' : 'in-progress'}" />
                                </div>

                                <div>

                                    <h:outputText value="$#{order.totalamount}" styleClass="order-total" style=" font-weight: bold" />

                                </div>

                            </div>

                            <div class="order-info">
                                <div>
                                    <i class="pi pi-chair"></i>
                                    <h:outputText value="Table #{order.tableId.tableNumber}" />
                                </div>

                                <div>
                                    <i class="pi pi-calendar"></i>
                                    <h:outputText value="#{order.orederDate}" >
                                        <f:convertDateTime pattern="dd-MM-yyyy" />
                                    </h:outputText>
                                </div>




                                <div class="order-footer" >
                                    <p:commandButton value="Update-order" icon="pi pi-pencil" action="#{orderBean.updateorder(order)}" update="@form" styleClass="details-btn" style="background-color:#0d1224 ; color: white; font-weight: bold" rendered="#{not order.iscompleted}" />
                                    <p:commandButton value="View Details" icon="pi pi-eye" styleClass="details-btn" action="#{orderBean.vieworder(order)}" style="font-weight: bold ;" update="@form"/>
                                </div>
                            </div>

                        </div>
                    </ui:repeat>
                </p:panel>
            </h:panelGroup>


            <h:panelGroup rendered="#{navigationBean.activePage eq 'view'}" layout="block" styleClass="main-content">

                <p:commandButton value="← Back to Orders" action="#{navigationBean.goOrderHistory()}" styleClass="back-btn ui-button-secondary" update="@form" style="background-color:#0d1224" />

                <h1>Order Details - <h:outputText value="#{orderBean.selectedorder.orderId}" /></h1>

                <!-- Main container -->
                <div class="order-container">

                    <!-- Order Information -->
                    <div class="order-cardd">
                        <div class="section-title">Order Information</div>

                        <div class="grid-layout">
                            <!-- Order Number -->
                            <div class="field-box">
                                <div class="order-label">Order Number</div>
                                <div class="order-value">#{orderBean.selectedorder.orderId}</div>
                            </div>

                            <!-- Status -->
                            <div class="field-box">
                                <div class="order-label">Status</div>
                                <div class="order-value">
                                    <span class="status-pill">
                                        #{orderBean.selectedorder.iscompleted ? 'completed' : 'in-progress'}
                                    </span>
                                </div>
                            </div>

                            <!-- Table -->
                            <div class="field-box">
                                <div class="order-label">Table</div>
                                <div class="order-value">#{orderBean.selectedorder.tableId.tableNumber}</div>
                            </div>

                            <!-- Date -->
                            <div class="field-box">
                                <div class="order-label">Date</div>
                                <div class="order-value">
                                    <h:outputText value="#{orderBean.selectedorder.orederDate}">
                                        <f:convertDateTime pattern="M/d/yyyy" />
                                    </h:outputText>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Section -->
                        <div class="payment-section">
                            <h:panelGroup rendered="#{not orderBean.selectedorder.iscompleted}">

                                <div class="field-box" >
                                    <div class="order-label">Payment Method</div>
                                    <p:selectOneMenu value="#{orderBean.paymentMethod}" styleClass="payment-dropdown">
                                        <f:selectItem itemLabel="Select" itemValue="" noSelectionOption="true"/>
                                        <f:selectItem itemLabel="Cash" itemValue="Cash" />
                                        <f:selectItem itemLabel="Online" itemValue="Online" />
                                    </p:selectOneMenu>
                                </div>
                                <div class="field-box">
                                    <div class="order-label" style="margin-left: 8rem">Discount (%)</div>
                                    <p:inputNumber value="#{orderBean.discountPercentage}" 
                                                   minValue="0" 
                                                   maxValue="100" 
                                                   decimalPlaces="0"
                                                   styleClass="discount-input"
                                                   style="margin-left: 8rem"
                                                   placeholder="Enter discount %" />
                                </div>

                            </h:panelGroup>




                            <div class="field-box">

                                <p:commandButton value="Generate Bill" icon="pi pi-print"
                                                 update="@form"
                                                 styleClass="generate-bill-btn"
                                                 action="#{orderBean.generatebill(orderBean.selectedorder)}"
                                                 rendered="#{not orderBean.selectedorder.iscompleted}"
                                                 style="margin-top: 1rem; margin-left: 7rem; background-color: red ; color: white"  />
                            </div>
                        </div>

                    </div>

                    <!-- Order Items -->
                    <div class="order-cardd">
                        <div class="section-title">Order Items</div>

                        <ui:repeat value="#{orderBean.oo}" var="item">
                            <div class="item-box">
                                <div>
                                    <div><strong>#{item.menuId.itemName}</strong></div>
                                    <div style="font-size: 0.9rem;">Qty: #{item.quantity}</div>
                                </div>
                                <div>$#{item.totalPrice}</div>
                            </div>
                        </ui:repeat>

                        <hr />
                        <div class="total">
                            Total: $#{orderBean.selectedorder.totalamount}
                        </div>
                    </div>
                </div>

            </h:panelGroup>
        </h:form>

    </h:body>
</html>
